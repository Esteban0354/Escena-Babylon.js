<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <title>Babylon.js sample code</title>

        <!-- Babylon.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://assets.babylonjs.com/generated/Assets.js"></script>
        <script src="https://cdn.babylonjs.com/recast.js"></script>
        <script src="https://cdn.babylonjs.com/ammo.js"></script>
        <script src="https://cdn.babylonjs.com/havok/HavokPhysics_umd.js"></script>
        <script src="https://cdn.babylonjs.com/cannon.js"></script>
        <script src="https://cdn.babylonjs.com/Oimo.js"></script>
        <script src="https://cdn.babylonjs.com/earcut.min.js"></script>
        <script src="https://cdn.babylonjs.com/babylon.js"></script>
        <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://cdn.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://cdn.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://cdn.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://cdn.babylonjs.com/addons/babylonjs.addons.min.js"></script>
        <script src="https://cdn.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

        <style>
            html,
            body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }

            #canvasZone {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div id="canvasZone"><canvas id="renderCanvas"></canvas></div>
        <script>
                    var canvas = document.getElementById("renderCanvas");

                    var startRenderLoop = function (engine, canvas) {
                        engine.runRenderLoop(function () {
                            if (sceneToRender && sceneToRender.activeCamera) {
                                sceneToRender.render();
                            }
                        });
                    }

                    var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function() { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true,  disableWebGL2Support: false}); };
        var createScene = function () {
  const scene = new BABYLON.Scene(engine);

  // Cámara, luz y suelo 
  const camera = new BABYLON.FreeCamera("camera1", new BABYLON.Vector3(-25, 6, 5), scene);
  camera.setTarget(BABYLON.Vector3.Zero());
  camera.attachControl(canvas, true);

  const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(2, 0, 0), scene);
  light.intensity = 0.7;

  const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 55, height: 55 }, scene);
  const groundMaterial = new BABYLON.StandardMaterial("groundMat", scene);
  groundMaterial.diffuseTexture = new BABYLON.Texture("https://thumbs.dreamstime.com/b/textura-de-la-hierba-seca-10061786.jpg", scene);
  ground.material = groundMaterial;

  // ---- Cargar UNA sola vez la palma como plantilla ----
  BABYLON.SceneLoader.ImportMesh(
    "",
    "https://raw.githubusercontent.com/Esteban0354/Escena-Babylon.js/main/",
    "palma2.glb",
    scene,
    function (meshes) {
      // Guardamos los meshes reales (descartamos transform nodes si vinieran)
      const templateMeshes = meshes.filter(m => m instanceof BABYLON.Mesh);

      // Desactivo la plantilla para que no se vea; solo sirve para copiar
      templateMeshes.forEach(m => m.setEnabled(false));

      // Función para “sembrar” una palma en la escena usando instancias (muy eficiente)
      function sembrarPalma(pos, rotY = 0, escala = 1) {
        const raiz = new BABYLON.TransformNode("palmaRoot_" + scene.getUniqueId(), scene);
        raiz.position = pos.clone();
        raiz.rotation = new BABYLON.Vector3(0, rotY, 0);
        raiz.scaling = new BABYLON.Vector3(escala, escala, escala);

        // Por cada mesh de la plantilla, creo una instancia y la cuelgo de la nueva raíz
        templateMeshes.forEach((tm, i) => {
          const inst = tm.createInstance(`palmaInst_${raiz.uniqueId}_${i}`);
          inst.parent = raiz;
        });
        return raiz;
      }

      // Fondo Utima fila izquierda / derecha
        sembrarPalma(new BABYLON.Vector3( 12, 3,  0),  Math.PI/2, 1);
        sembrarPalma(new BABYLON.Vector3( 13, 3,  2),  Math.PI/2, 0.9);
        sembrarPalma(new BABYLON.Vector3( 15, 3,  5),  Math.PI/2, 1);
        sembrarPalma(new BABYLON.Vector3( 13, 3,  7),  Math.PI/2, 0.9);
        sembrarPalma(new BABYLON.Vector3( 12, 3,  9),  Math.PI/2, 0.8);
        sembrarPalma(new BABYLON.Vector3( 14, 3,  11),  Math.PI/2, 0.9);
        sembrarPalma(new BABYLON.Vector3( 12, 3,  14),  Math.PI/2, 0.8);
        sembrarPalma(new BABYLON.Vector3( 13, 3,  16),  Math.PI/2, 1);
        sembrarPalma(new BABYLON.Vector3( 13, 3,  19),  Math.PI/2, 0.8);
        sembrarPalma(new BABYLON.Vector3( 15, 3,  21),  Math.PI/2, 0.9); 

        sembrarPalma(new BABYLON.Vector3( 13, 3,  -2),  Math.PI/2, 0.9);
        sembrarPalma(new BABYLON.Vector3( 15, 3,  -5),  Math.PI/2, 0.8);
        sembrarPalma(new BABYLON.Vector3( 13, 3,  -7),  Math.PI/2, 1);
        sembrarPalma(new BABYLON.Vector3( 12, 3,  -9),  Math.PI/2, 0.8);
        sembrarPalma(new BABYLON.Vector3( 14, 3,  -11),  Math.PI/2, 0.9);
        sembrarPalma(new BABYLON.Vector3( 12, 3,  -14),  Math.PI/2, 0.8);
        sembrarPalma(new BABYLON.Vector3( 13, 3,  -16),  Math.PI/2, 0.9);
        sembrarPalma(new BABYLON.Vector3( 13, 3,  -19),  Math.PI/2, 1);
        sembrarPalma(new BABYLON.Vector3( 15, 3,  -21),  Math.PI/2, 0.9); 


    // llenar 
        sembrarPalma(new BABYLON.Vector3( 15, 3,  0),  Math.PI/2, 0.6);
        sembrarPalma(new BABYLON.Vector3( 11, 3,  2),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 13, 3,  5),  Math.PI/2,1);
        sembrarPalma(new BABYLON.Vector3( 16, 3,  7),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 12, 3,  9),  Math.PI/2, 0.6);
        sembrarPalma(new BABYLON.Vector3( 16, 3,  11),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 15, 3,  14),  Math.PI/2, 0.6);
        sembrarPalma(new BABYLON.Vector3( 15, 3,  16),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 16, 3,  19),  Math.PI/2, 0.6);
        sembrarPalma(new BABYLON.Vector3( 12, 3,  21),  Math.PI/2,1); 

        sembrarPalma(new BABYLON.Vector3( 15, 3,  -2),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 13, 3,  -5),  Math.PI/2, 1);
        sembrarPalma(new BABYLON.Vector3( 16, 3,  -7),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 11, 3,  -9),  Math.PI/2, 0.6);
        sembrarPalma(new BABYLON.Vector3( 16, 3,  -11),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 14, 3,  -14),  Math.PI/2, 0.6);
        sembrarPalma(new BABYLON.Vector3( 16, 3,  -16),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 12, 3,  -19),  Math.PI/2, 1);
        sembrarPalma(new BABYLON.Vector3( 16, 3,  -21),  Math.PI/2, 0.7); 


    // Semi circulo
        sembrarPalma(new BABYLON.Vector3( 2, 3,  19),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 2, 3,  21),  Math.PI/2, 0.6);
        sembrarPalma(new BABYLON.Vector3( 1, 3,  22),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 1, 3,  20),  Math.PI/2, 0.6);

        sembrarPalma(new BABYLON.Vector3( 2, 3,  -13),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 2, 3,  -12),  Math.PI/2, 0.6);
        sembrarPalma(new BABYLON.Vector3( 1, 3,  -11),  Math.PI/2, 0.7);
        sembrarPalma(new BABYLON.Vector3( 1, 3,  -14),  Math.PI/2, 0.6);


      // Soporte hamaca

        sembrarPalma(new BABYLON.Vector3( -3.6, 3,  12),  Math.PI/2, 1);
        sembrarPalma(new BABYLON.Vector3( 7, 3,  8),  Math.PI/2, 1);


        
    }
  );

  // Hamaca 
  BABYLON.SceneLoader.ImportMesh(
    "",
    "https://raw.githubusercontent.com/Esteban0354/Escena-Babylon.js/main/",
    "hamaca.glb",
    scene,
    function (meshes) {
      meshes[0].position = new BABYLON.Vector3(8.5, -1, 13);
      meshes[0].rotation = new BABYLON.Vector3(0, 2.15, 0);

    }
  );


 // Silla
   BABYLON.SceneLoader.ImportMesh(
    "",
    "https://raw.githubusercontent.com/Esteban0354/Escena-Babylon.js/main/",
    "catrecito.glb",
    scene,
    function (meshes) {
      meshes[0].position = new BABYLON.Vector3(8, 0, 4);
      meshes[0].rotation = new BABYLON.Vector3(0, 2, 0);

    }
  );

     BABYLON.SceneLoader.ImportMesh(
    "",
    "https://raw.githubusercontent.com/Esteban0354/Escena-Babylon.js/main/",
    "hombreEscena.glb",
    scene,
    function (meshes) {
      meshes[0].position = new BABYLON.Vector3(5, 0, 12);
      meshes[0].rotation = new BABYLON.Vector3(0, 2, 0);

    }
  );


//mujer
  BABYLON.SceneLoader.ImportMesh(
  "",
  "https://raw.githubusercontent.com/Esteban0354/Escena-Babylon.js/main/",
  "mujerEscena.glb",
  scene,
  function (meshes) {
    // Position and rotation
    meshes[0].position = new BABYLON.Vector3(-12, -9.5, -38);
    meshes[0].rotation = new BABYLON.Vector3(0, 0, 0);

    // Upscale the mesh (double its size in x,y,z)
    meshes[0].scaling = new BABYLON.Vector3(20 , 20, 20);
  });




  return scene;
};

                window.initFunction = async function() {
                    
                    
                    
                    var asyncEngineCreation = async function() {
                        try {
                        return createDefaultEngine();
                        } catch(e) {
                        console.log("the available createEngine function failed. Creating the default engine instead");
                        return createDefaultEngine();
                        }
                    }

                    window.engine = await asyncEngineCreation();
                    
                    const engineOptions = window.engine.getCreationOptions?.();
                    if (!engineOptions || engineOptions.audioEngine !== false) {
                        
                    }
        if (!engine) throw 'engine should not be null.';
        startRenderLoop(engine, canvas);
        window.scene = createScene();};
        initFunction().then(() => {sceneToRender = scene
                    });

                    // Resize
                    window.addEventListener("resize", function () {
                        engine.resize();
                    });
        </script>
    </body>
</html>
